<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æœ±ä»™é•‡æœ¨ç‰ˆå¹´ç”» - ç§‘æ™®å°æ¸¸æˆ</title>
    <link rel="icon" href="images/puzzles/1.png" type="image/png">
    <link rel="shortcut icon" href="images/puzzles/1.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@500;700&display=swap"
        rel="stylesheet">

    <style>
        /* =========================================
           1. å…¨å±€ä¸åŸºç¡€æ ·å¼
           ========================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Noto Serif SC', serif;
            background-color: #f0dcb8;
        }

        /* é¡µé¢å®¹å™¨ */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, transform 0.5s ease;
            z-index: 10;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            z-index: -1;
            transform: scale(0.95);
        }

        /* èƒŒæ™¯å±‚ */
        .bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #fffdf5 0%, #f0dcb8 60%, #dcb885 100%);
            z-index: 0;
        }

        .bg-illustration {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-image: url('https://images.unsplash.com/photo-1599577348037-29530495f503?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center bottom;
            opacity: 0.4;
            mask-image: linear-gradient(to top, black, transparent);
            -webkit-mask-image: linear-gradient(to top, black, transparent);
            z-index: 1;
        }

        /* é€šç”¨é¢æ¿æ¡† */
        .panel-box {
            position: relative;
            z-index: 20;
            background: rgba(255, 253, 245, 0.92);
            border: 2px solid #bfa373;
            outline: 4px solid rgba(191, 163, 115, 0.3);
            box-shadow: 0 10px 30px rgba(92, 64, 30, 0.25);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .panel-box::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px solid #8c6434;
            pointer-events: none;
            border-radius: 6px;
        }

        /* èƒ¶å›ŠæŒ‰é’® */
        .capsule-btn {
            font-family: 'Ma Shan Zheng', cursive;
            background: linear-gradient(to bottom, #f7e3ba 0%, #d4a055 100%);
            border: 1px solid #c79653;
            color: #5d3a1a;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .capsule-btn:active {
            transform: scale(0.95) brightness(0.9);
        }

        /* å…¨å±€é€€å‡ºæŒ‰é’® (å›ºå®šå·¦ä¸‹è§’) */
        .back-btn {
            position: fixed !important;
            top: auto !important;
            bottom: 40px !important;
            left: 20px !important;
            z-index: 1000;
            background: rgba(93, 58, 26, 0.95);
            color: #fff;
            border: 2px solid #bfa373;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            margin-bottom: env(safe-area-inset-bottom);
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        /* =========================================
           2. é¦–é¡µä¸èœå•æ ·å¼
           ========================================= */
        #page-index .panel-box {
            width: 85%;
            max-width: 600px;
            padding: 50px 20px;
            text-align: center;
        }

        .main-title {
            font-family: 'Ma Shan Zheng', cursive;
            color: #5d3a1a;
            font-size: 13vw;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        @media (min-width: 768px) {
            .main-title {
                font-size: 5rem;
            }
        }

        .main-title span {
            display: block;
            font-size: 0.6em;
            color: #8b5e3c;
            margin-top: 5px;
        }

        .start-btn-lg {
            margin-top: 40px;
            padding: 12px 0;
            width: 70%;
            max-width: 240px;
            font-size: 1.6rem;
        }

        .stamp-tag {
            position: absolute;
            right: 15px;
            top: -10px;
            background-color: #c92a2a;
            color: #fff;
            padding: 6px 3px;
            font-size: 14px;
            writing-mode: vertical-rl;
            border-radius: 2px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            font-family: 'Ma Shan Zheng', cursive;
        }

        /* èœå•å¸ƒå±€ (å“å­—å½¢) */
        #page-select .panel-box {
            width: 90%;
            max-width: 500px;
            height: auto;
            min-height: 60%;
            padding: 30px 20px;
        }

        .menu-header {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .menu-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2rem;
            color: #5d3a1a;
            margin: 0 15px;
        }

        .deco-line {
            height: 2px;
            width: 30px;
            background-color: #bfa373;
            position: relative;
        }

        .deco-line::after {
            content: '';
            position: absolute;
            top: -3px;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #bfa373;
        }

        .deco-line.left::after {
            right: auto;
            left: 0;
        }

        .game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            row-gap: 30px;
            column-gap: 20px;
            width: 100%;
            padding: 10px 0;
        }

        .grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .grid-item:first-child {
            grid-column: 1 / -1;
            margin-bottom: 10px;
        }

        .circle-thumb {
            width: 26vw;
            height: 26vw;
            max-width: 110px;
            max-height: 110px;
            border-radius: 50%;
            border: 4px solid #d4a055;
            background-color: #eee;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .grid-item:first-child .circle-thumb {
            width: 32vw;
            height: 32vw;
            max-width: 140px;
            max-height: 140px;
            border-color: #c92a2a;
        }

        .circle-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            transition: transform 0.3s;
        }

        .grid-item:hover .circle-thumb img {
            transform: scale(1.1);
        }

        .grid-btn {
            padding: 8px 0;
            width: 100%;
            min-width: 100px;
            font-size: 1.1rem;
        }

        .grid-item:first-child .grid-btn {
            width: 60%;
            font-size: 1.3rem;
        }

        /* =========================================
           3. æ‹¼å›¾æ¸¸æˆæ ·å¼
           ========================================= */
        #page-gameplay {
            background-color: #3e2723;
            flex-direction: column;
            justify-content: flex-start;
            z-index: 50;
        }

        .game-nav {
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 15px;
            background: rgba(0, 0, 0, 0.4);
            z-index: 20;
            position: relative;
        }

        .game-title-bar {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: #f7e3ba;
            font-family: 'Ma Shan Zheng';
            font-size: 1.5rem;
            white-space: nowrap;
        }

        .hint-btn,
        .score-badge {
            position: absolute;
            right: 15px;
            color: #f7e3ba;
            font-family: 'Ma Shan Zheng';
            font-size: 1.2rem;
        }

        .hint-btn {
            background: #d4a055;
            border: 1px solid #bfa373;
            color: #5d3a1a;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .puzzle-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        /* ç«–ç‰ˆé€‚é… */
        .puzzle-board {
            height: 60vh;
            width: auto;
            aspect-ratio: 268 / 390;
            max-width: 90vw;
            background: #fffdf5;
            border: 4px solid #bfa373;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            padding: 2px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            margin: 0 auto;
        }

        .puzzle-piece {
            background-size: 300% 300%;
            cursor: pointer;
            transition: transform 0.2s;
            border-radius: 2px;
        }

        .puzzle-piece.selected {
            transform: scale(0.95);
            box-shadow: 0 0 10px #fce300;
            border: 2px solid #fce300;
            z-index: 10;
        }

        .puzzle-tip {
            margin-top: 20px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 30;
            pointer-events: none;
        }

        .hint-overlay img {
            width: auto;
            height: 70%;
            border: 4px solid #fff;
        }

        /* èƒœåˆ©å¼¹çª—é€šç”¨ */
        .win-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 60;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .win-content {
            background: #fffdf5;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            width: 85%;
            max-width: 340px;
            border: 4px solid #bfa373;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        /* æ•…äº‹æ»šåŠ¨æ¡† */
        .story-box {
            background: rgba(240, 220, 184, 0.3);
            border: 1px dashed #bfa373;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            max-height: 25vh;
            overflow-y: auto;
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4e342e;
            text-indent: 2em;
        }

        /* å¼¹çª—å¤§æŒ‰é’® */
        .win-btn-group {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            width: 100%;
        }

        .win-btn-group .capsule-btn {
            width: 80% !important;
            padding: 12px 0 !important;
            font-size: 1.3rem !important;
            display: block;
        }

        .capsule-btn.secondary {
            background: none;
            border: 2px solid #8c6434 !important;
            color: #8c6434;
            font-weight: bold;
        }

        /* =========================================
           4. é—®ç­”æ¸¸æˆæ ·å¼
           ========================================= */
        #page-quiz {
            background-color: #5d4037;
            flex-direction: column;
        }

        .quiz-container {
            flex: 1;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-bottom: 80px;
        }

        .question-card {
            background: #fffdf5;
            padding: 25px 20px;
            border-radius: 10px;
            border: 3px solid #bfa373;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            position: relative;
            text-align: center;
        }

        .q-tag {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #c92a2a;
            color: white;
            padding: 4px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .q-text {
            font-size: 1.2rem;
            color: #3e2723;
            font-weight: bold;
            line-height: 1.6;
            margin-top: 10px;
        }

        .quiz-tools {
            display: flex;
            justify-content: flex-end;
            width: 100%;
            margin-bottom: 15px;
        }

        .tool-btn {
            background: #fbc02d;
            color: #5d3a1a;
            border: 2px solid #f57f17;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }

        .tool-btn:disabled {
            background: #e0e0e0;
            color: #999;
            border-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: #eaddcf;
            border: 2px solid #bfa373;
            padding: 12px;
            border-radius: 50px;
            font-size: 1rem;
            color: #5d3a1a;
            text-align: left;
            padding-left: 20px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .option-btn:active {
            transform: scale(0.98);
        }

        .option-btn.correct {
            background: #a5d6a7;
            border-color: #2e7d32;
            color: #1b5e20;
        }

        .option-btn.wrong {
            background: #ef9a9a;
            border-color: #c62828;
            color: #b71c1c;
        }

        .option-btn.eliminated {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(100%);
        }

        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 80;
        }

        .feedback-box {
            background: #fff;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            animation: slideUp 0.3s ease-out;
        }

        .fb-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .fb-text {
            color: #666;
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* é—®ç­”ä¸‹ä¸€é¢˜æŒ‰é’® */
        .feedback-box .capsule-btn {
            width: 50% !important;
            min-width: 140px;
            padding: 8px 0 !important;
            font-size: 1.1rem !important;
            margin-top: 15px !important;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* =========================================
           5. ç¿»ç‰Œæ¸¸æˆæ ·å¼
           ========================================= */
        #page-memory {
            background-color: #3e2723;
            flex-direction: column;
        }

        .memory-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding-bottom: 60px;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 90vw;
            max-width: 360px;
            padding: 10px;
        }

        .card {
            background-color: transparent;
            width: 100%;
            aspect-ratio: 3 / 4;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* åŒ¹é…æˆåŠŸåŠ¨ç”»ï¼šä¿ç•™æ˜¾ç¤ºï¼Œç»¿å…‰é«˜äº® */
        @keyframes matchSuccessAnim {
            0% {
                transform: scale(1);
                border-color: #d4a055;
            }

            50% {
                transform: scale(1.1);
                border-color: #4caf50;
                box-shadow: 0 0 15px #4caf50;
            }

            100% {
                transform: scale(1);
                border-color: #4caf50;
                opacity: 1;
            }
        }

        .card.matched {
            pointer-events: none;
            animation: matchSuccessAnim 0.5s ease-out forwards;
        }

        .card.matched .card-back {
            border-color: #4caf50 !important;
            border-width: 3px;
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 8px;
            border: 2px solid #d4a055;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card-front {
            background: #8c6434;
            background-image: repeating-linear-gradient(45deg, #8c6434 0, #8c6434 10px, #7a562b 10px, #7a562b 20px);
            color: #f7e3ba;
            font-family: 'Ma Shan Zheng';
            font-size: 2rem;
        }

        .card-back {
            background-color: #fffdf5;
            transform: rotateY(180deg);
            background-size: cover;
            background-position: center;
        }

        /* èŠ±ç“£åŠ¨ç”» */
        .falling-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50% 0 50% 0;
            opacity: 0.7;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translate(0, -10px) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            100% {
                transform: translate(50px, 105vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- èƒŒæ™¯å±‚ -->
    <div class="bg-layer"></div>
    <div class="bg-illustration"></div>
    <div class="falling-container" id="fallingContainer"></div>

    <!-- 1. é¦–é¡µ -->
    <div id="page-index" class="page">
        <div class="panel-box">
            <div class="stamp-tag">éé—æ–‡åŒ–</div>
            <h1 class="main-title">æœ±ä»™é•‡<span>æœ¨ç‰ˆå¹´ç”»</span></h1>
            <div style="font-size: 1.1rem; color:#8c6434; font-family:'Ma Shan Zheng'">ä¼ ç»Ÿå·¥è‰ºç§‘æ™®å°æ¸¸æˆ</div>
            <button class="capsule-btn start-btn-lg" onclick="goToPage('page-select')">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- 2. èœå•é¡µ -->
    <div id="page-select" class="page hidden">
        <button class="back-btn" onclick="goToPage('page-index')">â† è¿”å›é¦–é¡µ</button>
        <div class="panel-box">
            <div class="menu-header">
                <div class="deco-line left"></div>
                <h2 class="menu-title">æ¸¸è‰ºå·¥åŠ</h2>
                <div class="deco-line"></div>
            </div>

            <div class="game-grid">
                <!-- æ‹¼å›¾ (Top) -->
                <div class="grid-item">
                    <div class="circle-thumb">
                        <img src="images/puzzle.jpg" alt="Puzzle">
                    </div>
                    <button class="capsule-btn grid-btn" onclick="startGameLevel('puzzle')">å¹´ç”»æ‹¼å›¾</button>
                </div>
                <!-- ç¿»ç‰Œ (Left) -->
                <div class="grid-item">
                    <div class="circle-thumb">
                        <img src="images/memory.jpg" alt="Memory">
                    </div>
                    <button class="capsule-btn grid-btn" onclick="startGameLevel('memory')">ç¿»ç‰Œè®°å¿†</button>
                </div>
                <!-- é—®ç­” (Right) -->
                <div class="grid-item">
                    <div class="circle-thumb">
                        <img src="images/quiz.jpg" alt="Quiz">
                    </div>
                    <button class="capsule-btn grid-btn" onclick="startGameLevel('quiz')">çŸ¥è¯†é—®ç­”</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. æ‹¼å›¾æ¸¸æˆ -->
    <div id="page-gameplay" class="page hidden">
        <div class="game-nav">
            <div class="game-title-bar">å¹´ç”»æ‹¼å›¾</div>
            <button class="hint-btn" ontouchstart="showHint()" ontouchend="hideHint()" onmousedown="showHint()"
                onmouseup="hideHint()">æŒ‰ä½çœ‹å›¾</button>
        </div>
        <button class="back-btn" onclick="goToPage('page-select')">â† é€€å‡º</button>

        <div class="puzzle-container">
            <div id="puzzle-board" class="puzzle-board"></div>
            <div class="puzzle-tip">ç‚¹å‡»ä¸¤å—ç¢ç‰‡è¿›è¡Œäº¤æ¢</div>
        </div>
        <div id="hint-overlay" class="hint-overlay hidden">
            <img id="hint-image" src="" alt="åŸå›¾">
        </div>

        <div id="win-modal" class="win-modal hidden">
            <div class="win-content">
                <h2 style="color:#c92a2a; margin-bottom:5px; font-family:'Ma Shan Zheng'">æ‹¼å›¾æˆåŠŸ!</h2>
                <h3 id="story-title" style="color:#5d3a1a; font-size:1.1rem; margin-bottom:10px; font-weight:bold;">
                </h3>
                <div class="story-box">
                    <p id="story-desc">åŠ è½½ä¸­...</p>
                </div>
                <div class="win-btn-group">
                    <button class="capsule-btn" onclick="initPuzzleGame()">å†ç©ä¸€æ¬¡</button>
                    <button class="capsule-btn secondary" onclick="goToPage('page-select')">è¿”å›èœå•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. é—®ç­”æ¸¸æˆ -->
    <div id="page-quiz" class="page hidden">
        <div class="game-nav">
            <div class="game-title-bar">ç§‘æ™®é—®ç­”</div>
            <div class="score-badge">å¾—åˆ†: <span id="quiz-score">0</span></div>
        </div>
        <button class="back-btn" onclick="goToPage('page-select')">â† é€€å‡º</button>

        <div class="quiz-container">
            <div class="question-card">
                <div class="q-tag">ç¬¬ <span id="q-current">1</span>/<span id="q-total">5</span> é¢˜</div>
                <p id="question-text" class="q-text">é¢˜ç›®åŠ è½½ä¸­...</p>
            </div>
            <div class="quiz-tools">
                <button id="btn-hint" class="tool-btn" onclick="useHint()">ğŸ’¡ æç¤º (æ’é™¤é”™è¯¯)</button>
            </div>
            <div id="options-list" class="options-list"></div>
        </div>

        <div id="quiz-feedback" class="feedback-overlay hidden">
            <div class="feedback-box">
                <div id="fb-icon" class="fb-icon">âœ…</div>
                <h3 id="fb-title">å›ç­”æ­£ç¡®!</h3>
                <p id="fb-explain" class="fb-text">è§£æ...</p>
                <button class="capsule-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <div id="quiz-result" class="win-modal hidden">
            <div class="win-content">
                <h2 style="color:#c92a2a; margin-bottom:10px; font-family:'Ma Shan Zheng'">æŒ‘æˆ˜ç»“æŸ</h2>
                <p style="font-size:1.2rem; margin-bottom:10px;">ä½ çš„å¾—åˆ†: <b id="final-score"
                        style="color:#d4a055; font-size:1.5rem;"></b></p>
                <p id="result-title" style="color:#888; margin-bottom:20px;"></p>
                <div class="win-btn-group">
                    <button class="capsule-btn" onclick="initQuizGame()">å†æµ‹ä¸€æ¬¡</button>
                    <button class="capsule-btn secondary" onclick="goToPage('page-select')">è¿”å›èœå•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. ç¿»ç‰Œæ¸¸æˆ -->
    <div id="page-memory" class="page hidden">
        <div class="game-nav">
            <div class="game-title-bar">å¹´ç”»è®°å¿†</div>
            <div class="score-badge">æ­¥æ•°: <span id="memory-steps">0</span></div>
        </div>
        <button class="back-btn" onclick="goToPage('page-select')">â† é€€å‡º</button>

        <div class="memory-container">
            <div id="memory-board" class="memory-board"></div>
            <div class="puzzle-tip" style="margin-top:15px;">ç¿»å¼€å¡ç‰‡ï¼Œå¯»æ‰¾ç›¸åŒçš„å›¾æ¡ˆ</div>
        </div>

        <div id="memory-win" class="win-modal hidden">
            <div class="win-content">
                <h2 style="color:#c92a2a; margin-bottom:10px; font-family:'Ma Shan Zheng'">æŒ‘æˆ˜æˆåŠŸ!</h2>
                <p style="font-size:1.1rem; color:#5d3a1a;">ä½ å¯¹å¹´ç”»çš„ç»†èŠ‚è®°å¿†åŠ›æƒŠäººï¼</p>
                <div class="win-btn-group">
                    <button class="capsule-btn" onclick="initMemoryGame()">å†ç©ä¸€æ¬¡</button>
                    <button class="capsule-btn secondary" onclick="goToPage('page-select')">è¿”å›èœå•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ğŸš€ å…¨å±€é€»è¾‘ä¸ç‰¹æ•ˆ
        // ============================================
        function goToPage(targetId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (!page.classList.contains('hidden')) {
                    page.style.opacity = '0';
                    page.style.transform = 'scale(0.95)';
                    setTimeout(() => page.classList.add('hidden'), 500);
                }
            });
            setTimeout(() => {
                const targetPage = document.getElementById(targetId);
                targetPage.classList.remove('hidden');
                requestAnimationFrame(() => {
                    targetPage.style.opacity = '1';
                    targetPage.style.transform = 'scale(1)';
                });
            }, 500);
        }

        function startGameLevel(levelName) {
            if (levelName === 'puzzle') {
                goToPage('page-gameplay');
                setTimeout(initPuzzleGame, 100);
            } else if (levelName === 'quiz') {
                goToPage('page-quiz');
                setTimeout(initQuizGame, 100);
            } else if (levelName === 'memory') {
                goToPage('page-memory');
                setTimeout(initMemoryGame, 100);
            }
        }

        function createPetals() {
            const container = document.getElementById('fallingContainer');
            for (let i = 0; i < 8; i++) setTimeout(() => spawnPetal(container), i * 800);
        }
        function spawnPetal(container) {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            const left = Math.random() * 100;
            const size = Math.random() * 8 + 4;
            const dur = Math.random() * 5 + 8;
            const colorVar = Math.random();
            if (colorVar > 0.6) petal.style.backgroundColor = '#d46a6a';
            else if (colorVar > 0.3) petal.style.backgroundColor = '#e6b88a';
            else petal.style.backgroundColor = '#f7d3ba';
            petal.style.left = left + '%'; petal.style.width = size + 'px'; petal.style.height = size + 'px'; petal.style.animationDuration = dur + 's';
            container.appendChild(petal);
            petal.addEventListener('animationend', () => { petal.remove(); spawnPetal(container); });
        }
        window.onload = createPetals;

        // ============================================
        // ğŸ§© æ‹¼å›¾æ¸¸æˆ (éšæœº1-25 + æ•…äº‹åº“)
        // ============================================
        const puzzleFolder = "images/puzzles/";
        const puzzleExt = ".png"; // âš ï¸å¦‚æœæ˜¯jpgæ”¹è¿™é‡Œ
        const puzzleTotal = 25;

        let puzzleImageLibrary = [];
        for (let i = 1; i <= puzzleTotal; i++) {
            puzzleImageLibrary.push(`${puzzleFolder}${i}${puzzleExt}`);
        }

        const puzzleStories = [
            null,
            { title: "é›²è¨˜ãƒ»æ­¥ä¸‹é­å°‰è¿Ÿæ­", desc: "è¿™æ˜¯å°‰è¿Ÿæ­ï¼ˆå°‰è¿Ÿæ•¬å¾·ï¼‰ï¼Œä¸ºå”ä»£å¼€å›½åå°†ã€‚ä¼ è¯´å”å¤ªå®—æä¸–æ°‘å› å™©æ¢¦ç¼ èº«ï¼Œä»–ä¸ç§¦ç¼ä¸»åŠ¨å®ˆåœ¨å®«é—¨é©±èµ°é¬¼é­…ï¼Œä»æ­¤æˆä¸ºæ°‘é—´æœ€å—æ¬¢è¿çš„é—¨ç¥ä¹‹ä¸€ã€‚è¿™å¼ æ˜¯â€œæ­¥ä¸‹é­â€é€ å‹ï¼Œå°‰è¿Ÿæ­æ‰‹æŒé‡‘é­ï¼Œèº«æŠ«é±¼é³ç”²ï¼Œå¨é£å‡›å‡›ã€‚â€œé›²è¨˜â€æ˜¯æ°‘å›½æ—¶æœŸå¼€å°è‘—åçš„å¹´ç”»å•†å·ã€‚" },
            { title: "æŒ¯æºæ°¸ãƒ»é©¬ä¸Šé­ç§¦ç¼", desc: "è¿™æ˜¯ç§¦ç¼ï¼ˆç§¦å”å®ï¼‰ï¼Œä¸ºå”ä»£å¼€å›½åå°†ï¼Œä¹Ÿæ˜¯é—¨ç¥çš„æ ¸å¿ƒå½¢è±¡ä¹‹ä¸€ã€‚ä»–æ‰‹æŒåŒé”ï¼Œéª‘é»„éª é©¬ï¼Œå±äºâ€œé©¬ä¸Šé­â€é€ å‹ã€‚ä¼ è¯´ç§¦ç¼ä¸å°‰è¿Ÿæ­ä¸ºå”å¤ªå®—å®ˆå®«é—¨åï¼Œå…¶ç”»åƒè¢«è´´äºå®¶å®¶æˆ·æˆ·é—¨ä¸Šè¾Ÿé‚ªã€‚â€œæŒ¯æºæ°¸â€æ˜¯æœ±ä»™é•‡ä¼ ç»Ÿå¹´ç”»ä½œåŠå­—å·ã€‚" },
            { title: "è€åº—ãƒ»æ­¥ä¸‹é­ç§¦ç¼", desc: "è¿™æ˜¯ç§¦ç¼ï¼ˆç§¦å”å®ï¼‰ï¼Œä¸ºâ€œæ­¥ä¸‹é­â€é€ å‹ã€‚ä»–æ‰‹æŒåŒé”ï¼Œå§¿æ€åˆšåŠ²ï¼Œæ˜¯æœ±ä»™é•‡â€œè€åº—â€ä½œåŠçš„ç»å…¸é—¨ç¥æ ·å¼ã€‚ç§¦ç¼åœ¨æ°‘é—´è¢«å°Šä¸ºâ€œæŠ¤å®…é—¨ç¥â€ï¼Œå…¶å½¢è±¡å¯“æ„å®ˆæŠ¤å®¶å®…ã€é©±é‚ªçº³ç¦ã€‚" },
            { title: "è€åº—ãƒ»é©¬ä¸Šé­å°‰è¿Ÿæ­", desc: "è¿™æ˜¯å°‰è¿Ÿæ­ï¼ˆå°‰è¿Ÿæ•¬å¾·ï¼‰ï¼Œä¸ºâ€œé©¬ä¸Šé­â€é€ å‹ã€‚ä»–éª‘ä¹Œéª“é©¬ï¼ŒæŒé‡‘é­ï¼Œæ˜¯â€œè€åº—â€ä½œåŠçš„ä»£è¡¨ä½œå“ã€‚å°‰è¿Ÿæ­çš„é»‘è„¸å½¢è±¡ä¸ç§¦ç¼çš„çº¢è„¸å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œåœ¨æ°‘é—´é—¨ç¥ä¸­é€šå¸¸æˆå¯¹å‡ºç°ï¼Œè±¡å¾â€œå·¦å³å®ˆæŠ¤ã€æ— æ•¢çŠ¯è€…â€ã€‚" },
            { title: "é›²è¨˜ãƒ»é©¬ä¸Šé­ç§¦ç¼", desc: "è¿™æ˜¯ç§¦ç¼ï¼ˆç§¦å”å®ï¼‰ï¼Œä¸ºâ€œé©¬ä¸Šé­â€é€ å‹ï¼Œç”±â€œé›²è¨˜â€å•†å·å‡ºå“ã€‚ä»–éª‘é»„éª é©¬ï¼ŒæŒåŒé”ï¼Œå§¿æ€è‹±æ­¦ã€‚è¿™ç±»éª‘é©¬é—¨ç¥é€šå¸¸è´´äºå¤§æˆ·äººå®¶çš„é™¢é—¨ï¼Œå¯“æ„â€œé©¬åˆ°æˆåŠŸã€é©±é‚ªé•‡å®…â€ã€‚" },
            { title: "è€åº—ãƒ»é©¬ä¸Šé­ç§¦ç¼", desc: "è¿™æ˜¯ç§¦ç¼ï¼ˆç§¦å”å®ï¼‰ï¼Œä¸ºâ€œé©¬ä¸Šé­â€é€ å‹ï¼Œç”±â€œè€åº—â€ä½œåŠå‡ºå“ã€‚ä»–çš„å½¢è±¡å¤¸å¼ ç²—çŠ·ï¼Œè‰²å½©æµ“çƒˆï¼Œç¬¦åˆæœ±ä»™é•‡å¹´ç”»â€œå¤´å¤§èº«å°ã€çº¿æ¡ç®€ç»ƒâ€çš„è‰ºæœ¯ç‰¹ç‚¹ã€‚" },
            { title: "é›²è¨˜ãƒ»æ­¥ä¸‹é­å…³ç¾½", desc: "è¿™æ˜¯å…³ç¾½ï¼ˆå…³äº‘é•¿ï¼‰ï¼Œæ‰‹æŒé’é¾™åƒæœˆåˆ€ï¼Œèº«æŠ«ç»¿è¢ï¼Œæ˜¯æ°‘é—´ä¿¡ä»°ä¸­çš„â€œå¿ ä¹‰ä¹‹ç¥â€ã€‚å…³ç¾½ä½œä¸ºé—¨ç¥ï¼Œæ—¢å–å…¶â€œç¥å¨â€éœ‡æ…‘é‚ªç¥Ÿï¼Œä¹Ÿå€Ÿå…¶â€œå¿ ä¹‰â€è±¡å¾å®¶åº­ä¼¦ç†çš„åšå®ˆã€‚" },
            { title: "è€åº—ãƒ»æ­¥ä¸‹é­å¼ é£", desc: "è¿™æ˜¯å¼ é£ï¼ˆå¼ ç¿¼å¾·ï¼‰ï¼Œæ‰‹æŒä¸ˆå…«è›‡çŸ›ï¼Œé»‘è„¸åœ†çã€‚å¼ é£çš„å½¢è±¡å¯“æ„â€œå‹‡çŒ›é©±é‚ªã€å®ˆæŠ¤å®¶å®…â€ï¼Œå¸¸ä¸å…³ç¾½æˆå¯¹å‡ºç°ï¼Œè±¡å¾â€œå¿ ä¹‰åŒå…¨ã€å†…å¤–å®ˆæŠ¤â€ã€‚" },
            { title: "é›²è¨˜ãƒ»ç«‹åˆ€å…³ç¾½", desc: "è¿™æ˜¯å…³ç¾½ï¼ˆå…³äº‘é•¿ï¼‰ï¼Œä¸ºâ€œç«‹åˆ€â€é€ å‹ï¼Œç”±â€œé›²è¨˜â€å•†å·å‡ºå“ã€‚ä»–æ‰‹æŒé’é¾™åƒæœˆåˆ€ï¼Œå§¿æ€å¨ä¸¥ï¼Œæ˜¯æ°‘é—´ä¿¡ä»°ä¸­â€œæ‹›è´¢è¿›å®ã€é©±é‚ªé¿ç¾â€çš„å…¨èƒ½ç¥ç¥‡ã€‚" },
            { title: "è€åº—ãƒ»æ­¥ä¸‹é­å¼ é£", desc: "è¿™æ˜¯å¼ é£ï¼ˆå¼ ç¿¼å¾·ï¼‰ï¼Œä¸ºâ€œæ­¥ä¸‹é­â€é€ å‹ï¼Œç”±â€œè€åº—â€ä½œåŠå‡ºå“ã€‚ä»–çš„å½¢è±¡ç²—çŠ·è±ªæ”¾ï¼Œè‰²å½©æµ“çƒˆï¼Œä½“ç°äº†æœ±ä»™é•‡å¹´ç”»â€œçº¿æ¡ç²—çŠ·ã€é€ å‹å¤¸å¼ â€çš„è‰ºæœ¯é£æ ¼ã€‚" },
            { title: "å¸¦å­é—¨ç¥ãƒ»ç§¦ç¼", desc: "è¿™æ˜¯ç§¦ç¼çš„â€œå¸¦å­é—¨ç¥â€é€ å‹ã€‚ç”»é¢ä¸­ç§¦ç¼èº«æŠ«é“ ç”²ï¼Œèº«æ—è·Ÿéšä¸€åç«¥å­ï¼Œè¿™ç§â€œå¸¦å­â€å½¢è±¡å¯“æ„â€œå®¶æ—ä¼ æ‰¿ã€å­å—£ç»µå»¶â€ï¼Œæ—¢ä¿å®¶å®…å¹³å®‰ï¼Œä¹Ÿç¥ˆæ„¿äººä¸å…´æ—ºã€‚" },
            { title: "å¸¦å­é—¨ç¥ãƒ»å°‰è¿Ÿæ­", desc: "è¿™æ˜¯å°‰è¿Ÿæ­çš„â€œå¸¦å­é—¨ç¥â€é€ å‹ï¼Œä¸ç§¦ç¼æˆå¯¹å‡ºç°ã€‚å°‰è¿Ÿæ­æ‰‹æŒé•¿æªï¼Œèº«æ—ç«¥å­ç›¸ä¼´ï¼Œå»¶ç»­äº†â€œå¸¦å­é—¨ç¥â€çš„å‰ç¥¥å¯“æ„ï¼Œè±¡å¾â€œå®ˆæŠ¤å®¶å®…ã€ç¦æ³½åä»£â€ã€‚" },
            { title: "é›²è¨˜ãƒ»åæ——å®˜å…³ç¾½", desc: "è¿™æ˜¯å…³ç¾½çš„â€œåæ——å®˜â€é€ å‹ï¼Œç”±â€œé›²è¨˜â€å•†å·å‡ºå“ã€‚å…³ç¾½èº«æŠ«ç»¿è¢ï¼Œæ‰‹æŒä»¤æ——ä¸å®å°ï¼Œå§¿æ€å¨ä¸¥åº„é‡ã€‚â€œåæ——å®˜â€è±¡å¾â€œæƒå¨ã€å¿ ä¹‰ä¸æŠ¤ä½‘â€ã€‚" },
            { title: "è€åº—ãƒ»åæ——å®˜å¼ é£", desc: "è¿™æ˜¯å¼ é£çš„â€œåæ——å®˜â€é€ å‹ï¼Œç”±â€œè€åº—â€ä½œåŠå‡ºå“ã€‚å¼ é£æ‰‹æŒä»¤æ——ï¼Œç¥æ€åˆšçŒ›ï¼Œè±¡å¾â€œå¿ ä¹‰åŒå…¨ã€å¨æ…‘é‚ªç¥Ÿâ€ã€‚é€‚åˆè´´äºå•†é“ºæˆ–é™¢é—¨ã€‚" },
            { title: "é›²è¨˜ãƒ»åæ——å®˜å²³é£", desc: "è¿™æ˜¯å²³é£ï¼ˆå²³é¹ä¸¾ï¼‰çš„â€œåæ——å®˜â€é€ å‹ã€‚å²³é£æ‰‹æŒä»¤æ——ï¼Œèº«æŠ«é“ ç”²ï¼Œæ˜¯æ°‘é—´ä¿¡ä»°ä¸­â€œå¿ å›çˆ±å›½ã€é©±é‚ªæŠ¤æ°‘â€çš„ç²¾ç¥è±¡å¾ã€‚" },
            { title: "è€åº—ãƒ»åæ——å®˜èµµåŒ¡èƒ¤", desc: "è¿™æ˜¯èµµåŒ¡èƒ¤ï¼ˆå®‹å¤ªç¥–ï¼‰çš„â€œåæ——å®˜â€é€ å‹ã€‚èµµåŒ¡èƒ¤æ‰‹æŒä»¤æ——ï¼Œç¥æ€å¨ä¸¥ï¼Œä½œä¸ºå¼€å›½çš‡å¸ï¼Œå…¶å½¢è±¡è±¡å¾â€œçš‡æƒæŠ¤ä½‘ã€å®¶å®…ç¨³å›ºâ€ã€‚" },
            { title: "é›²è¨˜ãƒ»é©¬ä¸Šé­ç‡ƒç¯é“äºº", desc: "è¿™æ˜¯ç‡ƒç¯é“äººï¼ˆé“æ•™ç¥ç¥‡ï¼‰çš„â€œé©¬ä¸Šé­â€é€ å‹ã€‚ä»–éª‘ä¹˜ç¥å…½ï¼Œæ‰‹æŒé•¿é­ï¼Œç™½é¡»é£˜é€¸ï¼Œæ˜¯é“æ•™ä½“ç³»ä¸­â€œé©±é‚ªé•‡ç…ã€æŠ¤æŒæ­£é“â€çš„é‡è¦ç¥ç¥‡ã€‚" },
            { title: "è€åº—ãƒ»æ­¥ä¸‹é­èµµå…¬æ˜", desc: "è¿™æ˜¯èµµå…¬æ˜ï¼ˆæ­¦è´¢ç¥ï¼‰çš„â€œæ­¥ä¸‹é­â€é€ å‹ã€‚ä»–éª‘ä¹˜é»‘è™ï¼Œæ‰‹æŒé“é­ï¼Œæ˜¯æ°‘é—´ä¿¡ä»°ä¸­æœ€å…·å½±å“åŠ›çš„è´¢ç¥ä¹‹ä¸€ï¼Œå¯“æ„æ‹›è´¢è¿›å®ã€é©±é‚ªé•‡å®…ã€‚" },
            { title: "æŒ¯æºæ°¸ãƒ»é©¬ä¸Šé­å§œå¤ªå…¬", desc: "è¿™æ˜¯å§œå­ç‰™ï¼ˆå§œå¤ªå…¬ï¼‰çš„â€œé©¬ä¸Šé­â€é€ å‹ï¼Œç”±â€œæŒ¯æºæ°¸â€ä½œåŠå‡ºå“ã€‚ä»–éª‘ä¹˜ç¥å…½ï¼Œæ‰‹æŒæ‰“ç¥é­ï¼Œç™½é¡»é£˜é€¸ï¼Œå¯“æ„â€œè¯¸ç¥é€€ä½ã€ç™¾é‚ªä¸ä¾µâ€ã€‚" },
            { title: "æœ±ä»™é•‡ãƒ»æ­¥ä¸‹é­é’Ÿé¦—", desc: "è¿™æ˜¯é’Ÿé¦—çš„â€œæ­¥ä¸‹é­â€é€ å‹ã€‚ä»–éª‘ä¹˜ç¥å…½ï¼Œæ‰‹æŒå®å‰‘ï¼Œè±¹å¤´ç¯çœ¼ï¼Œæ˜¯æ°‘é—´ä¼ è¯´ä¸­â€œæ‰é¬¼é©±é‚ªâ€çš„ä¸“èŒç¥ç¥‡ï¼Œå¯“æ„â€œé•‡å®…é©±é‚ªã€ä¿å¹³å®‰â€ã€‚" },
            { title: "é›²è¨˜ãƒ»é€å­è´¢ç¥", desc: "è¿™æ˜¯æ–‡è´¢ç¥ï¼ˆæ¯”å¹²/èŒƒè ¡ï¼‰çš„â€œé€å­â€é€ å‹ã€‚è´¢ç¥èº«æŠ«å®˜è¢ï¼Œç«¥å­æ‰‹æŒå®ç“¶èŠ±æï¼Œå¯“æ„â€œèŠ±å¼€å¯Œè´µã€å­å—£ç»µå»¶â€ï¼Œæ˜¯æ·±å—å–œçˆ±çš„â€œåŒå–œâ€é¢˜æã€‚" },
            { title: "å¤©å®˜èµç¦", desc: "è¿™æ˜¯å¤©å®˜ï¼Œæ‰‹æŒâ€œå¤©å®˜èµç¦â€çº¢è‰²å·è½´ï¼Œå½¢è±¡ç«¯åº„å¨ä¸¥ã€‚åœ¨æ°‘é—´ä¿¡ä»°ä¸­ï¼Œå¤©å®˜æŒç®¡äººé—´ç¦ç¦„ï¼Œå¯“æ„è¿æ¥ç¦æ°”ã€ç¥ˆæ±‚ä¸€å¹´é¡ºé‚å¹³å®‰ã€‚" },
            { title: "æ•™å­æˆåãƒ»åå—è¯°å°", desc: "è¿™æ˜¯ä¸€å¹…æ•™åŒ–ç±»å¹´ç”»ï¼Œæç»˜æ¯äº²æ•™å­æˆæ‰ã€‚ä¸Šæ–¹é¢˜å­—â€œæ•™å­æˆå åå—è¯°å°â€ï¼Œä¼ é€’â€œæ¯æ…ˆå­å­ã€è€•è¯»ä¼ å®¶â€çš„ä¼ ç»Ÿä»·å€¼è§‚ã€‚" },
            { title: "å¤©åœ°å¾—æ„ãƒ»åˆ©å¸‚ä»™å®˜", desc: "è¿™æ˜¯åˆ©å¸‚ä»™å®˜ï¼Œç”»é¢æ ‡æ³¨â€œå¤©åœ°å¾—æ„â€ï¼Œæ‰‹æŒâ€œæ‹›è´¢åˆ©å¸‚â€å·è½´ã€‚å¯“æ„â€œç”Ÿæ„çº¢ç«ã€è´¢æºå¹¿è¿›â€ï¼Œé€‚åˆè´´äºå•†é“ºæŸœå°æˆ–å®¶åº­è´¢ä½ã€‚" },
            { title: "äº”å­ç™»ç§‘ãƒ»ç¦ç¦„å¯¿ä¸‰æ˜Ÿ", desc: "è¿™æ˜¯äº”å­ç™»ç§‘é¢˜æï¼Œæ ¸å¿ƒä¸ºç¦æ˜Ÿï¼Œç¯ç»•äº”ä½ç«¥å­ã€‚å¯“æ„â€œå­å¼Ÿæˆæ‰ã€å®¶æ—å…´æ—ºâ€ï¼Œå¯„æ‰˜ç€çˆ¶æ¯å¯¹å­å¥³å­¦ä¸šæœ‰æˆã€å…‰å®—è€€ç¥–çš„æœŸæœ›ã€‚" }
        ];

        let currentPuzzleImage = "";
        let currentPuzzleIndex = 0;
        let pieces = [];
        let selectedPieceIndex = -1;
        const gridSize = 3;

        function initPuzzleGame() {
            const board = document.getElementById('puzzle-board');
            const hintImg = document.getElementById('hint-image');

            // éšæœº1-25
            currentPuzzleIndex = Math.floor(Math.random() * puzzleTotal) + 1;
            currentPuzzleImage = `${puzzleFolder}${currentPuzzleIndex}${puzzleExt}`;

            hintImg.src = currentPuzzleImage;
            board.innerHTML = '';
            document.getElementById('win-modal').classList.add('hidden');

            pieces = Array.from({ length: gridSize * gridSize }, (_, i) => i);
            do {
                pieces.sort(() => Math.random() - 0.5);
            } while (checkWinCondition(true));

            pieces.forEach((imgIndex, gridIndex) => {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.dataset.index = gridIndex;
                const x = (imgIndex % gridSize) * 50;
                const y = Math.floor(imgIndex / gridSize) * 50;
                piece.style.backgroundImage = `url(${currentPuzzleImage})`;
                piece.style.backgroundPosition = `${x}% ${y}%`;
                piece.onclick = () => handlePieceClick(gridIndex);
                board.appendChild(piece);
            });
            selectedPieceIndex = -1;
        }

        function handlePieceClick(clickedIndex) {
            const pieceDivs = document.querySelectorAll('.puzzle-piece');
            if (selectedPieceIndex === -1) {
                selectedPieceIndex = clickedIndex;
                pieceDivs[clickedIndex].classList.add('selected');
                return;
            }
            if (selectedPieceIndex === clickedIndex) {
                selectedPieceIndex = -1;
                pieceDivs[clickedIndex].classList.remove('selected');
                return;
            }
            swapPieces(selectedPieceIndex, clickedIndex);
        }

        function swapPieces(indexA, indexB) {
            const pieceDivs = document.querySelectorAll('.puzzle-piece');
            const divA = pieceDivs[indexA];
            const divB = pieceDivs[indexB];
            const tempBg = divA.style.backgroundPosition;
            divA.style.backgroundPosition = divB.style.backgroundPosition;
            divB.style.backgroundPosition = tempBg;
            [pieces[indexA], pieces[indexB]] = [pieces[indexB], pieces[indexA]];
            divA.classList.remove('selected');
            selectedPieceIndex = -1;
            if (checkWinCondition()) setTimeout(showPuzzleWin, 300);
        }

        function checkWinCondition(isSilent = false) {
            for (let i = 0; i < pieces.length; i++) if (pieces[i] !== i) return false;
            return true;
        }

        function showPuzzleWin() {
            let storyData = puzzleStories[currentPuzzleIndex];
            if (!storyData) storyData = { title: "æœ±ä»™é•‡å¹´ç”»", desc: "è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„æœ±ä»™é•‡æœ¨ç‰ˆå¹´ç”»ï¼Œè•´å«ç€æ·±åšçš„æ–‡åŒ–åº•è•´ã€‚" };
            document.getElementById('story-title').innerText = storyData.title;
            document.getElementById('story-desc').innerText = storyData.desc;
            document.getElementById('win-modal').classList.remove('hidden');
        }

        function showHint() { document.getElementById('hint-overlay').classList.remove('hidden'); }
        function hideHint() { document.getElementById('hint-overlay').classList.add('hidden'); }

        // ============================================
        // ğŸ§  çŸ¥è¯†é—®ç­”æ¸¸æˆ (éšæœº5é¢˜ + æç¤º)
        // ============================================
        const quizDatabase = [
            { q: "æœ±ä»™é•‡æœ¨ç‰ˆå¹´ç”»äº§è‡ªå“ªä¸ªçœä»½ï¼Ÿ", opts: ["A. æ²³å—", "B. å¤©æ´¥", "C. æ±Ÿè‹", "D. å››å·"], a: 0, exp: "æœ±ä»™é•‡ä½äºæ²³å—çœå¼€å°å¸‚ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»åˆ¶ä½œä¸»è¦ä½¿ç”¨å“ªç§æœ¨æï¼Ÿ", opts: ["A. æ¾æœ¨", "B. æ¢¨æœ¨", "C. æ¡¦æœ¨", "D. æª€æœ¨"], a: 1, exp: "æ¢¨æœ¨çº¹ç†ç»†è…»ï¼Œé€‚åˆé›•åˆ»ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»é¢œæ–™ä¸»è¦æ¥æºäºï¼Ÿ", opts: ["A. åŒ–å­¦åˆæˆ", "B. çŸ¿çŸ³", "C. æ¤ç‰©ç†¬åˆ¶", "D. è¿›å£"], a: 2, exp: "ä¼ ç»Ÿå·¥è‰ºä½¿ç”¨æ¤ç‰©é¢œæ–™ï¼Œä¹…ä¸è¤ªè‰²ã€‚" },
            { q: "ä»¥ä¸‹å“ªä¸ªä¸æ˜¯æœ±ä»™é•‡å¹´ç”»å¸¸ç”¨è‰²ï¼Ÿ", opts: ["A. ç´«è‰²", "B. ç»¿è‰²", "C. é»‘è‰²", "D. è§å…‰ç²‰"], a: 3, exp: "ä¼ ç»Ÿå¹´ç”»ä¸å«ç°ä»£è§å…‰è‰²ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»æœ€å¤§çš„å·¥è‰ºç‰¹è‰²æ˜¯ï¼Ÿ", opts: ["A. æ°´å¢¨å†™æ„", "B. æ‰‹å·¥æç»˜", "C. å¥—è‰²å°åˆ·", "D. ç”µè„‘å–·ç»˜"], a: 2, exp: "å®Œå…¨é€šè¿‡å¤šå—æœ¨æ¿åˆ†å±‚å¥—è‰²å°åˆ·ã€‚" },
            { q: "è¢«èª‰ä¸ºæœ±ä»™é•‡å¹´ç”»é¼»ç¥–çš„æ˜¯ï¼Ÿ", opts: ["A. é—¨ç¥", "B. è´¢ç¥", "C. ç¶ç‹çˆ·", "D. é’Ÿé¦—"], a: 0, exp: "é—¨ç¥ç”»èµ·æºæœ€æ—©ï¼Œæ˜¯å…¶ä»£è¡¨ä½œã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»äººç‰©å½¢è±¡çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ", opts: ["A. ç˜¦éª¨å¶™å³‹", "B. å¤´å¤§èº«å°", "C. å†™å®é€¼çœŸ", "D. é»‘ç™½åˆ†æ˜"], a: 1, exp: "é€ å‹å¤¸å¼ ï¼Œå¾€å¾€å¤´å¤§èº«å°ï¼Œæ˜¾å¾—å¨ä¸¥é¥±æ»¡ã€‚" },
            { q: "è´´å¹´ç”»é€šå¸¸æ˜¯åœ¨å“ªä¸ªèŠ‚æ—¥ï¼Ÿ", opts: ["A. ä¸­ç§‹èŠ‚", "B. ç«¯åˆèŠ‚", "C. æ˜¥èŠ‚", "D. æ¸…æ˜èŠ‚"], a: 2, exp: "è¾æ—§è¿æ–°ï¼Œæ˜¥èŠ‚è´´å¹´ç”»ã€‚" },
            { q: "â€œæ­¥ä¸‹é­â€è¿™å¹…å¹´ç”»æç»˜çš„æ˜¯å“ªä¸¤ä½ï¼Ÿ", opts: ["A. å…³ç¾½å¼ é£", "B. ç§¦ç¼æ•¬å¾·", "C. åˆ˜å¤‡è¯¸è‘›äº®", "D. å­™æ‚Ÿç©ºå…«æˆ’"], a: 1, exp: "ç§¦ç¼ä¸å°‰è¿Ÿæ­ï¼ˆæ•¬å¾·ï¼‰æ˜¯ç»å…¸çš„é—¨ç¥å½¢è±¡ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»ä¸­ï¼Œä»£è¡¨â€œå¤šå­å¤šç¦â€çš„æ˜¯ï¼Ÿ", opts: ["A. è²èŠ±", "B. éº’éºŸé€å­", "C. ç‰¡ä¸¹", "D. çŒ›è™"], a: 1, exp: "éº’éºŸé€å­å¯“æ„å®¶æ—å…´æ—ºï¼Œæ—©ç”Ÿè´µå­ã€‚" },
            { q: "å¹´ç”»ä¸­â€œè™è â€çš„å›¾æ¡ˆå¯“æ„ä»€ä¹ˆï¼Ÿ", opts: ["A. é»‘æš—", "B. éåœ°æ˜¯ç¦", "C. é£ç¿”", "D. æ•é£Ÿ"], a: 1, exp: "â€œè â€ä¸â€œç¦â€è°éŸ³ï¼Œå¯“æ„éåœ°æ˜¯ç¦ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»è¢«åˆ—å…¥å›½å®¶çº§éé—åå½•æ˜¯åœ¨ï¼Ÿ", opts: ["A. 2006å¹´", "B. 1990å¹´", "C. 2020å¹´", "D. 2000å¹´"], a: 0, exp: "2006å¹´é¦–æ‰¹å…¥é€‰ã€‚" },
            { q: "ä¼ ç»Ÿå¹´ç”»çš„â€œçº¿ç‰ˆâ€æ˜¯æŒ‡ä»€ä¹ˆé¢œè‰²ï¼Ÿ", opts: ["A. çº¢è‰²", "B. é»‘è‰²", "C. é»„è‰²", "D. ç»¿è‰²"], a: 1, exp: "çº¿ç‰ˆå³å¢¨çº¿ç‰ˆï¼Œå°è½®å»“ï¼Œé€šå¸¸æ˜¯é»‘è‰²ã€‚" },
            { q: "ä¸‹åˆ—å“ªé¡¹ä¸æ˜¯æœ±ä»™é•‡å¹´ç”»çš„é¢˜æï¼Ÿ", opts: ["A. å†å²æ•…äº‹", "B. ç¥è¯ä¼ è¯´", "C. ç°ä»£æŠ½è±¡ç”»", "D. å‰ç¥¥å›¾æ¡ˆ"], a: 2, exp: "å¹´ç”»å¤šå–æäºä¼ ç»Ÿæ•…äº‹å’Œå‰ç¥¥å¯“æ„ã€‚" },
            { q: "â€œäº”å­å¤ºè²â€å¯“æ„æ˜¯ä»€ä¹ˆï¼Ÿ", opts: ["A. è¿ç”Ÿè´µå­", "B. äº”è°·ä¸°ç™»", "C. è¿å¹´æœ‰ä½™", "D. èŠ±å¼€å¯Œè´µ"], a: 0, exp: "è²ä¸è¿è°éŸ³ï¼Œå­ä»£è¡¨å­©å­ï¼Œå¯“æ„è¿ç”Ÿè´µå­ã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»ä¸­â€œé©¬ä¸Šé­â€çš„ä¸»è§’æ˜¯ï¼Ÿ", opts: ["A. å²³é£", "B. ç§¦ç¼æ•¬å¾·", "C. èµµäº‘", "D. ç©†æ¡‚è‹±"], a: 1, exp: "ç§¦ç¼æ•¬å¾·æœ‰é©¬ä¸Šé­å’Œæ­¥ä¸‹é­ä¸¤ç§é€ å‹ã€‚" },
            { q: "åˆ»æ¿æ—¶ï¼Œåˆ€æ³•è¦æ±‚æ˜¯ï¼Ÿ", opts: ["A. éšæ„å‘æŒ¥", "B. é™¡åˆ€ç«‹çº¿", "C. æµ…å°è¾„æ­¢", "D. æœºå™¨é›•åˆ»"], a: 1, exp: "é™¡åˆ€ç«‹çº¿ï¼Œåˆ»å‡ºçš„çº¿æ¡æŒºæ‹”æœ‰åŠ›ã€‚" },
            { q: "å°åˆ¶å¹´ç”»æ—¶ï¼Œé€šå¸¸å…ˆå°ä»€ä¹ˆç‰ˆï¼Ÿ", opts: ["A. è‰²ç‰ˆ", "B. å¢¨çº¿ç‰ˆ", "C. éšæ„", "D. ç­¾å"], a: 1, exp: "å…ˆå°å¢¨çº¿ç‰ˆå®šè½®å»“ï¼Œå†å¥—å°è‰²ç‰ˆã€‚" },
            { q: "æœ±ä»™é•‡å¹´ç”»çš„æ„å›¾ç‰¹ç‚¹æ˜¯ï¼Ÿ", opts: ["A. ç•™ç™½å¾ˆå¤š", "B. é¥±æ»¡ç´§å‡‘", "C. æ®‹ç¼ºç¾", "D. æç®€ä¸»ä¹‰"], a: 1, exp: "ç”»é¢é¥±æ»¡ï¼Œä¸ç•™å¤ªå¤šç©ºç™½ï¼Œæ˜¾å¾—çƒ­é—¹ã€‚" },
            { q: "â€œåˆ˜æµ·æˆé‡‘èŸ¾â€å¯“æ„ä»€ä¹ˆï¼Ÿ", opts: ["A. æ‹›è´¢è¿›å®", "B. èº«ä½“å¥åº·", "C. å­¦ä¸šæœ‰æˆ", "D. å‡ºå…¥å¹³å®‰"], a: 0, exp: "é‡‘èŸ¾åé’±ï¼Œå¯“æ„è´¢æºå¹¿è¿›ã€‚" }
        ];

        let currentRoundQuestions = [];
        let currentQIndex = 0;
        let quizScore = 0;

        function initQuizGame() {
            currentQIndex = 0;
            quizScore = 0;
            document.getElementById('quiz-score').innerText = "0";
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');

            let tempPool = [...quizDatabase];
            for (let i = tempPool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tempPool[i], tempPool[j]] = [tempPool[j], tempPool[i]];
            }
            currentRoundQuestions = tempPool.slice(0, 5);
            renderQuestion();
        }

        function renderQuestion() {
            const qData = currentRoundQuestions[currentQIndex];
            const hintBtn = document.getElementById('btn-hint');
            hintBtn.disabled = false; hintBtn.style.opacity = "1";

            document.getElementById('q-current').innerText = currentQIndex + 1;
            document.getElementById('q-total').innerText = currentRoundQuestions.length;
            document.getElementById('question-text').innerText = qData.q;

            const optionsBox = document.getElementById('options-list');
            optionsBox.innerHTML = '';
            qData.opts.forEach((optText, index) => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.innerText = optText;
                btn.onclick = () => handleAnswer(index, btn);
                optionsBox.appendChild(btn);
            });
        }

        function useHint() {
            const qData = currentRoundQuestions[currentQIndex];
            const allBtns = Array.from(document.querySelectorAll('.option-btn'));
            let wrongIndices = [];
            allBtns.forEach((btn, index) => { if (index !== qData.a) wrongIndices.push(index); });
            wrongIndices.sort(() => Math.random() - 0.5);
            wrongIndices.slice(0, 2).forEach(index => allBtns[index].classList.add('eliminated'));
            const hintBtn = document.getElementById('btn-hint');
            hintBtn.disabled = true; hintBtn.style.opacity = "0.6";
        }

        function handleAnswer(selectedIndex, btnElement) {
            const qData = currentRoundQuestions[currentQIndex];
            const isCorrect = (selectedIndex === qData.a);
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(btn => btn.style.pointerEvents = 'none');
            document.getElementById('btn-hint').disabled = true;

            if (isCorrect) {
                btnElement.classList.add('correct');
                quizScore += 20;
                document.getElementById('quiz-score').innerText = quizScore;
                showFeedback(true, qData.exp);
            } else {
                btnElement.classList.add('wrong');
                allBtns[qData.a].classList.add('correct');
                showFeedback(false, qData.exp);
            }
        }

        function showFeedback(isCorrect, explainText) {
            const fbBox = document.getElementById('quiz-feedback');
            fbBox.classList.remove('hidden');
            const fbIcon = document.getElementById('fb-icon');
            const fbTitle = document.getElementById('fb-title');
            const fbExplain = document.getElementById('fb-explain');
            if (isCorrect) {
                fbIcon.innerText = "âœ…"; fbTitle.innerText = "å›ç­”æ­£ç¡®!"; fbTitle.style.color = "#2e7d32";
            } else {
                fbIcon.innerText = "âŒ"; fbTitle.innerText = "å›ç­”é”™è¯¯"; fbTitle.style.color = "#c62828";
            }
            fbExplain.innerText = explainText;
        }

        function nextQuestion() {
            document.getElementById('quiz-feedback').classList.add('hidden');
            currentQIndex++;
            if (currentQIndex < currentRoundQuestions.length) renderQuestion();
            else showResult();
        }

        function showResult() {
            const resultModal = document.getElementById('quiz-result');
            document.getElementById('final-score').innerText = quizScore;
            let title = "";
            if (quizScore == 100) title = "è·å¾—ç§°å·ï¼šéé—ä¼ æ‰¿äºº (å®Œç¾!)";
            else if (quizScore >= 60) title = "è·å¾—ç§°å·ï¼šå·¥è‰ºåŒ äºº (ä¼˜ç§€)";
            else title = "è·å¾—ç§°å·ï¼šå¹´ç”»å­¦å¾’ (åŠ æ²¹)";
            document.getElementById('result-title').innerText = title;
            resultModal.classList.remove('hidden');
        }

        // ============================================
        // ğŸƒ ç¿»ç‰Œè®°å¿† (1-25 éšæœºæŠ½ 6)
        // ============================================
        const memoryImageLibrary = puzzleImageLibrary; // å¤ç”¨æ‹¼å›¾çš„1-25å¼ å›¾åº“

        let memoryCards = [];
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let matchCount = 0;
        let memorySteps = 0;

        function initMemoryGame() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
            matchCount = 0;
            memorySteps = 0;
            document.getElementById('memory-steps').innerText = '0';
            document.getElementById('memory-win').classList.add('hidden');

            let tempPool = [...memoryImageLibrary];
            tempPool.sort(() => Math.random() - 0.5);
            let selectedImages = tempPool.slice(0, 6);
            let fullDeck = [...selectedImages, ...selectedImages];
            fullDeck.sort(() => Math.random() - 0.5);

            fullDeck.forEach(imgUrl => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `<div class="card-inner"><div class="card-front">ç¦</div><div class="card-back" style="background-image: url('${imgUrl}')"></div></div>`;
                card.dataset.image = imgUrl;
                card.addEventListener('click', flipCard);
                board.appendChild(card);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;
            this.classList.add('flipped');
            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }
            secondCard = this;
            memorySteps++;
            document.getElementById('memory-steps').innerText = memorySteps;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.image === secondCard.dataset.image;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            resetBoard();
            matchCount++;
            if (matchCount === 6) setTimeout(() => document.getElementById('memory-win').classList.remove('hidden'), 800);
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoard();
            }, 600);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }
    </script>
</body>

</html>